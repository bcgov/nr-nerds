{"chunk":0,"numChunks":1,"fileHash":"LW1nykHQ7NQuQ+NMPf7uo+99JhH+lHVuQ8sbu/ovauQ=","filePath":"project-board-sync/src/rules/processors/__tests__/board-items.test.js","content":"const { test } = require('node:test');\nconst assert = require('node:assert/strict');\n\n// Mock rules to match the structure in rules.yml\nconst mockRules = {\n    rules: {\n        board_items: [{\n            name: \"PullRequest by Author\",\n            description: \"Add pull requests authored by monitored user\",\n            trigger: {\n                type: \"PullRequest\",\n                condition: \"monitored.users.includes(item.author)\"\n            },\n            action: \"add_to_board\",\n            skip_if: \"item.inProject\"\n        }]\n    },\n    monitoredUsers: ['test-user']\n};\n\n// Override the board rules module before requiring the module under test\nrequire('../../../config/board-rules').loadBoardRules = () => mockRules;\n\n// Now require the module under test\nconst { processBoardItemRules } = require('../unified-rule-processor');\n\n// Set up test env\nprocess.env.GITHUB_AUTHOR = 'test-user';\n\ntest('processBoardItemRules adds PR to board when author matches', async (t) => {\n    // Test fixture: Simple PR with minimal required fields\n    const pr = {\n        __typename: 'PullRequest',\n        author: { login: 'test-user' },\n        repository: { nameWithOwner: 'bcgov/test-repo' }\n    };\n\n    const actions = await processBoardItemRules(pr);\n    \n    // Assert we get exactly one action to add the PR\n    assert.equal(actions.length, 1, \n        'Should generate one action for matching author');\n    assert.equal(actions[0].action, 'add_to_board',\n        'Action should be add_to_board');\n    assert.equal(actions[0].params.item, pr,\n        'Action params should include the PR');\n});\n"}